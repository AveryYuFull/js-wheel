/*!
 * js-wheel v1.0.0
 * (c) 2017-2018 penyuying
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Wheel={})}(this,function(e){"use strict";function i(e){console.error("[Wheel warn]: "+e)}function c(e){for(var t=!0,n=0,i=arguments.length,o=Array(1<i?i-1:0),r=1;r<i;r++)o[r-1]=arguments[r];if(o&&o.length<1)return"boolean"==typeof e?{}:e;"boolean"==typeof e&&(t=e,e=o[0],n=1);for(var s=0+n;s<o.length;s++){var l=o[s];if(l instanceof Object)for(var a in l)t&&l[a]instanceof Object?e[a]=c(l[a]instanceof Array?[]:{},l[a]):e[a]=l[a]}return e}var d=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};var n=document.createElement("div").style,t=function(){var e={webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform",standard:"transform"};for(var t in e)if(void 0!==n[e[t]])return t;return!1}();function a(e){return!1!==t&&("standard"===t?e:t+e.charAt(0).toUpperCase()+e.substr(1))}var o,g=(o={},"ontouchstart"in window?(o.isTouchable=!0,o.EVENT_START="touchstart",o.EVENT_MOVE="touchmove",o.EVENT_END="touchend"):(o.isTouchable=!1,o.EVENT_START="mousedown",o.EVENT_MOVE="mousemove",o.EVENT_END="mouseup"),o.EVENT_CANCEL="touchcancel",o.EVENT_CLICK="click",o);var r={wheelEl:"",wheelItemEl:"",activeCls:"active",visibleCls:"visible",perspective:"1000px",blurWidth:20,itemHeight:0,selectedIndex:0},s=navigator.platform.toLowerCase(),l=navigator.userAgent.toLowerCase(),h=(-1<l.indexOf("iphone")||-1<l.indexOf("ipad")||-1<l.indexOf("ipod"))&&(-1<s.indexOf("iphone")||-1<s.indexOf("ipad")||-1<s.indexOf("ipod"));function f(e,t){(e=this._getElements(e)[0])?this._init(e,t):i("can not resolve the wrapper dom")}f.use=function(e,t){e instanceof Function?e(f,t):e&&e.default instanceof Function?e.default(f,t):i("can not resolve the use module")},f.use(function(e){e.prototype.dispatchEvent=function(e,t,n){if(e&&e.tagName&&t&&"string"==typeof t){var i=document.createEvent(window&&window.MouseEvent?"MouseEvents":"Event");i.initEvent(t,!0,!1),i._constructed=!0,i=c(i,n),e.dispatchEvent(i)}},e.prototype.on=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this,i=this;i._events=i._events||{},i._events[e]=i._events[e]||[],i._events[e].push([t,n])},e.prototype.once=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this,i=this,o=!1;function r(){i.off(e,r),o||(o=!0,t.apply(n,arguments))}r.fn=t,i.on(e,r)},e.prototype.off=function(e,t){var n=this._events[e];if(n)for(var i=n.length;i--;)(n[i][0]===t||n[i][0]&&n[i][0].fn===t)&&(n[i][0]=void 0)},e.prototype.trigger=function(e){var t=this._events&&this._events[e];if(t)for(var n=t.length,i=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t)),o=0;o<n;o++){var r=i[o],s=d(r,2),l=s[0],a=s[1];l&&l.apply(a,[].slice.call(arguments,1))}}}),f.use(function(e){e.prototype._resetItems=function(){var e=this._options,t=this._wheelEl;if(t){var n=this._getElements(e.wheelItemEl,t);n&&0<n.length?this._elItems=n:i("can not resolve the wheelItem dom")}else i("can not resolve the wheel dom")},e.prototype._initEl=function(e){var t=this,n=t._options;t._el=e,(t._wheelEl=t._getElements(n.wheelEl,e)[0])&&t._bindEvent()},e.prototype._getElements=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document,n=void 0;return e?n="string"==typeof e?t.querySelectorAll(e):e:t&&t!==document&&t.children&&0<t.children.length&&(n=t.children),n&&0===n.length&&(n=void 0),n&&!(n instanceof Array)&&n.length<1&&(n=[n]),n||[]},e.prototype._calcElementItemPostion=function(){var n=this;n._elItems.forEach(function(e,t){n.endAngle=n.itemAngle*t,e._index=t,e.angle=n.endAngle,e.style[a("transformOrigin")]="center center -"+n.r+"px",e.style[a("transform")]="translateZ("+n.r+"px) rotateX("+-n.endAngle+"deg)"}),n.endExceed=n.endAngle+30,n._setItemVisibility(n.beginAngle)},e.prototype._setItemVisibility=function(n){var i=this,e=i._options,o=e.activeCls,r=e.visibleCls;i._elItems.forEach(function(e){var t=Math.abs(e.angle-n);t<i.hightlightRange?e.classList.add(o):t<i.visibleRange?(e.classList.add(r),e.classList.remove(o)):(e.classList.remove(o),e.classList.remove(r))})},e.prototype._setAngle=function(e){var t=this._options;this._angle=e,this._wheelEl.style[a("transform")]="perspective("+t.perspective+") rotateY(0deg) rotateX("+e+"deg)",this._setItemVisibility(e)}}),f.use(function(e){e.prototype.getSelectedIndex=function(){var e=this,t=e._options,n=parseInt((e._angle/e.itemAngle).toFixed(0));return e._elItems&&n>e._elItems.length-1&&(n=e._elItems.length-1),n<0&&(n=0),Math.abs(n)||t&&parseInt(t.selectedIndex+"",10)||0},e.prototype.wheelTo=function(e,t,n){var i=this;i._wheelEl.style[a("transition")]="";var o=i._correctAngle(i.itemAngle*e);if(t&&0<t){var r=o-i._angle;i._scrollDistAngle(Date.now(),i._angle,r,t,n)}else i._setAngle(o),i._triggerEnd(n)},e.prototype._correctAngle=function(e){return e<this.beginAngle?this.beginAngle:e>this.endAngle?this.endAngle:e},e.prototype._startScroll=function(e){var t=this,n=e.changedTouches?e.changedTouches[0]:e,i=e.timeStamp||Date.now(),o=(n.pageY-t.lastMoveStart)/(i-t.lastMoveTime),r=0<o?-1:1,s=6e-4*r*-1,l=Math.abs(o/s),a=o*l/2,c=t._angle,d=t._calcAngle(a)*r,g=d;c+d<t.beginExceed&&(l=l*((d=t.beginExceed-c)/g)*.6),c+d>t.endExceed&&(l=l*((d=t.endExceed-c)/g)*.6),0!=d?t._scrollDistAngle(i,c,d,l):t._endScroll()},e.prototype._scrollDistAngle=function(e,t,n,i,o){var r,s,l,a,c=this;c.stopInertiaMove=!1,r=t,s=n,l=i/13,a=0,function e(){if(!c.stopInertiaMove){var t,n=-s*((t=(t=a)/l-1)*t*t*t-1)+r;if(c._setAngle(n),l-1<++a||n<c.beginExceed||n>c.endExceed)c._endScroll(o);else{var i=c.getSelectedIndex();c.dispatchEvent(c._el,"scroll",{index:i}),c.trigger("scroll",{index:i}),setTimeout(e,13)}}}()},e.prototype._endScroll=function(e){var t=this,n=t._wheelEl;if(t._angle<t.beginAngle)n.style[a("transition")]="150ms ease-out",t._setAngle(t.beginAngle);else if(t._angle>t.endAngle)n.style[a("transition")]="150ms ease-out",t._setAngle(t.endAngle);else{var i=parseInt((t._angle/t.itemAngle).toFixed(0));n.style[a("transition")]="100ms ease-out",t._setAngle(t.itemAngle*i)}t._triggerEnd(e)},e.prototype._triggerEnd=function(t){var n=this;setTimeout(function(){var e=n.getSelectedIndex();!n.trigger||e==n.lastIndex&&!0!==t||(n.dispatchEvent(n._el,"scrollEnd",{index:e}),n.trigger("scrollEnd",{index:e})),n.lastIndex=e,"function"==typeof t&&t()},0)},e.prototype._calcAngle=function(e){var t=parseFloat(this.r),n=t;e=Math.abs(e);var i=180*parseInt(e/this.d),o=(n*n+t*t-(e%=this.d)*e)/(2*n*t);return i+Math.acos(o)/(Math.PI/180)},e.prototype._initInertiaParams=function(){this.lastMoveTime=0,this.lastMoveStart=0,this.stopInertiaMove=!1},e.prototype._updateInertiaParams=function(e,t){var n=this,i=e.changedTouches?e.changedTouches[0]:e;if(t)n.lastMoveStart=i.pageY,n.lastMoveTime=e.timeStamp||Date.now(),n.startAngle=n._angle;else{var o=e.timeStamp||Date.now();300<o-n.lastMoveTime&&(n.lastMoveTime=o,n.lastMoveStart=i.pageY)}n.stopInertiaMove=!0},e.prototype._bindEvent=function(){var o=this,e=o._el,r=0,s=null,l=!1;e.addEventListener(g.EVENT_START,function(e){l=!0,e.preventDefault();var t=o.getSelectedIndex();o.dispatchEvent(o._el,"scrollEnd",{index:t}),o.trigger("scrollStart",{index:t}),o._wheelEl.style[a("transition")]="",s=(e.changedTouches?e.changedTouches[0]:e).pageY,r=o._angle,o._updateInertiaParams(e,!0)},!1),e.addEventListener(g.EVENT_END,function(e){l=!1,e.preventDefault(),o._startScroll(e)},!1),e.addEventListener(g.EVENT_CANCEL,function(e){l=!1,e.preventDefault(),o._startScroll(e)},!1),e.addEventListener(g.EVENT_MOVE,function(e){if(l){e.preventDefault();var t=(e.changedTouches?e.changedTouches[0]:e).pageY-s,n=o._calcAngle(t),i=0<t?r-n:r+n;i>o.endExceed&&(i=o.endExceed),i<o.beginExceed&&(i=o.beginExceed),o._setAngle(i),o._updateInertiaParams(e),o.trigger("scroll",{index:o.getSelectedIndex()})}},!1)}}),f.use(function(e){e.prototype.refresh=function(){var e=this,t=e._options,n=e._elItems,i=e.getSelectedIndex();e._resetItems(),e.height=e._el.offsetHeight,e.r=e.height/2-t.blurWidth,e.d=2*e.r,e.itemHeight=t.itemHeight||(n&&0<n.length?n[0].offsetHeight:40),e.itemAngle=parseInt(e._calcAngle(.8*e.itemHeight)),e.hightlightRange=e.itemAngle/2,e.visibleRange=90,e.beginAngle=0,e.beginExceed=e.beginAngle-30,e._angle=e.beginAngle,h&&(e._wheelEl.style[a("transformOrigin")]="center center "+e.r+"px"),e._calcElementItemPostion(!0),0<i&&e.wheelTo(i)},e.prototype._init=function(e,t){this._initOptions(t),this._initEl(e),this.refresh()},e.prototype._initOptions=function(e){return this._options=c({},r,e),this._options}}),f.Version="1.0.0",e.default=f,e.Wheel=f,Object.defineProperty(e,"__esModule",{value:!0})});