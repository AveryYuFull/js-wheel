/*!
 * js-wheel v1.0.2
 * (c) 2017-2018 penyuying
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Wheel={})}(this,function(e){"use strict";function i(e){console.error("[Wheel warn]: "+e)}function c(e){for(var t=!0,n=0,i=arguments.length,r=Array(1<i?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];if(r&&r.length<1)return"boolean"==typeof e?{}:e;"boolean"==typeof e&&(t=e,e=r[0],n=1);for(var s=0+n;s<r.length;s++){var l=r[s];if(l instanceof Object)for(var a in l)t&&l[a]instanceof Object?e[a]=c(l[a]instanceof Array?[]:{},l[a]):e[a]=l[a]}return e}var g=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};var n=document.createElement("div").style,t=function(){var e={webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform",standard:"transform"};for(var t in e)if(void 0!==n[e[t]])return t;return!1}();function h(e){return!1!==t&&("standard"===t?e:t+e.charAt(0).toUpperCase()+e.substr(1))}var r,d=(r={},"ontouchstart"in window?(r.isTouchable=!0,r.EVENT_START="touchstart",r.EVENT_MOVE="touchmove",r.EVENT_END="touchend"):(r.isTouchable=!1,r.EVENT_START="mousedown",r.EVENT_MOVE="mousemove",r.EVENT_END="mouseup"),r.EVENT_CANCEL="touchcancel",r.EVENT_CLICK="click",r);var o={wheelEl:"",wheelItemEl:"",activeCls:"active",visibleCls:"visible",perspective:"1000px",blurWidth:20,itemHeight:0,selectedIndex:0},s=navigator.platform.toLowerCase(),l=navigator.userAgent.toLowerCase(),a=(-1<l.indexOf("iphone")||-1<l.indexOf("ipad")||-1<l.indexOf("ipod"))&&(-1<s.indexOf("iphone")||-1<s.indexOf("ipad")||-1<s.indexOf("ipod"));function f(e,t){(e=this._getElements(e)[0])?this._init(e,t):i("can not resolve the wrapper dom")}f.use=function(e,t){e instanceof Function?e(f,t):e&&e.default instanceof Function?e.default(f,t):i("can not resolve the use module")},f.use(function(e){e.prototype.dispatchEvent=function(e,t,n){if(e&&e.tagName&&t&&"string"==typeof t){var i=document.createEvent(window&&window.MouseEvent?"MouseEvents":"Event");i.initEvent(t,!0,!1),i._constructed=!0,i=c(i,n),e.dispatchEvent(i)}},e.prototype.on=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this,i=this;i._events=i._events||{},i._events[e]=i._events[e]||[],i._events[e].push([t,n])},e.prototype.once=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this,i=this,r=!1;function o(){i.off(e,o),r||(r=!0,t.apply(n,arguments))}o.fn=t,i.on(e,o)},e.prototype.off=function(e,t){var n=this._events[e];if(n)for(var i=n.length;i--;)(n[i][0]===t||n[i][0]&&n[i][0].fn===t)&&(n[i][0]=void 0)},e.prototype.trigger=function(e){var t=this._events&&this._events[e];if(t)for(var n=t.length,i=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t)),r=0;r<n;r++){var o=i[r],s=g(o,2),l=s[0],a=s[1];l&&l.apply(a,[].slice.call(arguments,1))}}}),f.use(function(e){e.prototype._resetItems=function(){var e=this._options,t=this._wheelEl;if(t){var n=this._getElements(e.wheelItemEl,t);n&&0<n.length?this._elItems=n:i("can not resolve the wheelItem dom")}else i("can not resolve the wheel dom")},e.prototype._initEl=function(e){var t=this,n=t._options;t._el=e,(t._wheelEl=t._getElements(n.wheelEl,e)[0])&&t._bindEvent()},e.prototype._getElements=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document,n=void 0;return e?"string"==typeof e?n=t.querySelectorAll(e):"number"!=typeof e.length&&(n=[e]):t&&t!==document&&t.children&&0<t.children.length&&(n=t.children),n&&0===n.length&&(n=void 0),n&&!(n instanceof Array)&&n.length<1&&(n=[n]),n||[]},e.prototype._calcElementItemPostion=function(){var e=this,t=e._elItems;if(t&&0<t.length)for(var n=0;n<t.length;n++){var i=t[n];e.endAngle=e.itemAngle*n,i._index=n,i.angle=e.endAngle,i.style[h("transformOrigin")]="center center -"+e.r+"px",i.style[h("transform")]="translateZ("+e.r+"px) rotateX("+-e.endAngle+"deg)"}e.endExceed=e.endAngle+30,e._setItemVisibility(e.beginAngle)},e.prototype._setItemVisibility=function(e){var t=this._elItems,n=this._options,i=n.activeCls,r=n.visibleCls;if(t&&0<t.length)for(var o=0;o<t.length;o++){var s=t[o],l=Math.abs(s.angle-e);l<this.hightlightRange?s.classList.add(i):l<this.visibleRange?(s.classList.add(r),s.classList.remove(i)):(s.classList.remove(i),s.classList.remove(r))}},e.prototype._setAngle=function(e){var t=this._options;this._angle=e,this._wheelEl.style[h("transform")]="perspective("+t.perspective+") rotateY(0deg) rotateX("+e+"deg)",this._setItemVisibility(e)}}),f.use(function(e){e.prototype.getSelectedIndex=function(){var e=this,t=e._options,n=parseInt((e._angle/e.itemAngle).toFixed(0));return e._elItems&&n>e._elItems.length-1&&(n=e._elItems.length-1),n<0&&(n=0),Math.abs(n)||t&&parseInt(t.selectedIndex+"",10)||0},e.prototype.wheelTo=function(e,t,n){var i=this;i._wheelEl.style[h("transition")]="";var r=i._correctAngle(i.itemAngle*e);if(t&&0<t){var o=r-i._angle;i._scrollDistAngle(Date.now(),i._angle,o,t,n)}else i._setAngle(r),i._triggerEnd(n)},e.prototype._correctAngle=function(e){return e<this.beginAngle?this.beginAngle:e>this.endAngle?this.endAngle:e},e.prototype._startScroll=function(e){var t=this,n=e.changedTouches?e.changedTouches[0]:e,i=e.timeStamp||Date.now(),r=(n.pageY-t.lastMoveStart)/(i-t.lastMoveTime),o=0<r?-1:1,s=6e-4*o*-1,l=Math.abs(r/s),a=r*l/2,c=t._angle,g=t._calcAngle(a)*o,h=g;c+g<t.beginExceed&&(l=l*((g=t.beginExceed-c)/h)*.6),c+g>t.endExceed&&(l=l*((g=t.endExceed-c)/h)*.6),0!=g?t._scrollDistAngle(i,c,g,l):t._endScroll()},e.prototype._scrollDistAngle=function(e,t,n,i,r){var o,s,l,a,c=this;c.stopInertiaMove=!1,o=t,s=n,l=i/13,a=0,function e(){if(!c.stopInertiaMove){var t,n=-s*((t=(t=a)/l-1)*t*t*t-1)+o;if(c._setAngle(n),l-1<++a||n<c.beginExceed||n>c.endExceed)c._endScroll(r);else{var i=c.getSelectedIndex();c.dispatchEvent(c._el,"scroll",{index:i}),c.trigger("scroll",{index:i}),setTimeout(e,13)}}}()},e.prototype._endScroll=function(e){var t=this,n=t._wheelEl;if(t._angle<t.beginAngle)n.style[h("transition")]="150ms ease-out",t._setAngle(t.beginAngle);else if(t._angle>t.endAngle)n.style[h("transition")]="150ms ease-out",t._setAngle(t.endAngle);else{var i=parseInt((t._angle/t.itemAngle).toFixed(0));n.style[h("transition")]="100ms ease-out",t._setAngle(t.itemAngle*i)}t._triggerEnd(e)},e.prototype._triggerEnd=function(t){var n=this;setTimeout(function(){var e=n.getSelectedIndex();!n.trigger||e==n.lastIndex&&!0!==t||(n.dispatchEvent(n._el,"scrollEnd",{index:e}),n.trigger("scrollEnd",{index:e})),n.lastIndex=e,"function"==typeof t&&t()},0)},e.prototype._calcAngle=function(e){var t=parseFloat(this.r),n=t;e=Math.abs(e);var i=180*parseInt(e/this.d),r=(n*n+t*t-(e%=this.d)*e)/(2*n*t);return i+Math.acos(r)/(Math.PI/180)},e.prototype._initInertiaParams=function(){this.lastMoveTime=0,this.lastMoveStart=0,this.stopInertiaMove=!1},e.prototype._updateInertiaParams=function(e,t){var n=this,i=e.changedTouches?e.changedTouches[0]:e;if(t)n.lastMoveStart=i.pageY,n.lastMoveTime=e.timeStamp||Date.now(),n.startAngle=n._angle;else{var r=e.timeStamp||Date.now();300<r-n.lastMoveTime&&(n.lastMoveTime=r,n.lastMoveStart=i.pageY)}n.stopInertiaMove=!0},e.prototype._bindEvent=function(){var o=this,e=o._el,s=0,l=null,a=null,c=!1;e.addEventListener(d.EVENT_START,function(e){c=!0,e.preventDefault();var t=o.getSelectedIndex();o.dispatchEvent(o._el,"scrollEnd",{index:t}),o.trigger("scrollStart",{index:t}),o._wheelEl.style[h("transition")]="",l=(e.changedTouches?e.changedTouches[0]:e).pageY,a=l,s=o._angle,o._updateInertiaParams(e,!0)},!1),e.addEventListener(d.EVENT_END,function(e){c=!1,e.preventDefault(),Math.abs(l-a)<10&&o._triggerEnd(!0),o._startScroll(e)},!1),e.addEventListener(d.EVENT_CANCEL,function(e){c=!1,e.preventDefault(),o._startScroll(e)},!1),e.addEventListener(d.EVENT_MOVE,function(e){if(c){e.preventDefault();var t=(e.changedTouches?e.changedTouches[0]:e).pageY,n=(a=t)-l,i=o._calcAngle(n),r=0<n?s-i:s+i;r>o.endExceed&&(r=o.endExceed),r<o.beginExceed&&(r=o.beginExceed),o._setAngle(r),o._updateInertiaParams(e),o.trigger("scroll",{index:o.getSelectedIndex()})}},!1)}}),f.use(function(e){e.prototype.refresh=function(){var e=this,t=e._options,n=e._elItems,i=e.getSelectedIndex();e._resetItems(),e.height=e._el.offsetHeight,e.r=e.height/2-t.blurWidth,e.d=2*e.r,e.itemHeight=t.itemHeight||(n&&0<n.length?n[0].offsetHeight:40),e.itemAngle=parseInt(e._calcAngle(.8*e.itemHeight)),e.hightlightRange=e.itemAngle/2,e.visibleRange=90,e.beginAngle=0,e.beginExceed=e.beginAngle-30,e._angle=e.beginAngle,a&&(e._wheelEl.style[h("transformOrigin")]="center center "+e.r+"px"),e._calcElementItemPostion(!0),0<i&&e.wheelTo(i)},e.prototype._init=function(e,t){this._initOptions(t),this._initEl(e),this.refresh()},e.prototype._initOptions=function(e){return this._options=c({},o,e),this._options}}),f.Version="1.0.2",e.default=f,e.Wheel=f,Object.defineProperty(e,"__esModule",{value:!0})});