/*!
 * js-wheel v1.0.0
 * (c) 2017-2017 penyuying
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Wheel={})}(this,function(e){"use strict";function o(e){console.error("[Wheel warn]: "+e)}var c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};var n=document.createElement("div").style,t=function(){var e={webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform",standard:"transform"};for(var t in e)if(void 0!==n[e[t]])return t;return!1}();function l(e){return!1!==t&&("standard"===t?e:t+e.charAt(0).toUpperCase()+e.substr(1))}var i,g=(i={},"ontouchstart"in window?(i.isTouchable=!0,i.EVENT_START="touchstart",i.EVENT_MOVE="touchmove",i.EVENT_END="touchend"):(i.isTouchable=!1,i.EVENT_START="mousedown",i.EVENT_MOVE="mousemove",i.EVENT_END="mouseup"),i.EVENT_CANCEL="touchcancel",i.EVENT_CLICK="click",i);var r={wheelEl:"",wheelItemEl:"",activeCls:"active",visibleCls:"visible",perspective:"1000px"},s=navigator.platform.toLowerCase(),a=navigator.userAgent.toLowerCase(),h=(-1<a.indexOf("iphone")||-1<a.indexOf("ipad")||-1<a.indexOf("ipod"))&&(-1<s.indexOf("iphone")||-1<s.indexOf("ipad")||-1<s.indexOf("ipod"));function d(e,t){(e=this._getElements(e)[0])?this._init(e,t):o("can not resolve the wrapper dom")}d.use=function(e,t){e instanceof Function?e(d,t):e&&e.default instanceof Function?e.default(d,t):o("can not resolve the use module")},d.use(function(e){e.prototype.on=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this,i=this;i._events=i._events||{},i._events[e]=i._events[e]||[],i._events[e].push([t,n])},e.prototype.once=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this,i=this,r=!1;function o(){i.off(e,o),r||(r=!0,t.apply(n,arguments))}o.fn=t,i.on(e,o)},e.prototype.off=function(e,t){var n=this._events[e];if(n)for(var i=n.length;i--;)(n[i][0]===t||n[i][0]&&n[i][0].fn===t)&&(n[i][0]=void 0)},e.prototype.trigger=function(e){var t=this._events&&this._events[e];if(t)for(var n=t.length,i=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t)),r=0;r<n;r++){var o=i[r],s=c(o,2),a=s[0],l=s[1];a&&a.apply(l,[].slice.call(arguments,1))}}}),d.use(function(e){e.prototype._initEl=function(e){var t=this,n=t._options;t._el=e;var i=t._wheelEl=t._getElements(n.wheelEl,e)[0];if(i){var r=t._getElements(n.wheelItemEl,i);r&&0<r.length?(t._elItems=r,t.refresh(),t._bindEvent()):o("can not resolve the wheelItem dom")}else o("can not resolve the wheel dom")},e.prototype._getElements=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document,n=void 0;return e?n="string"==typeof e?t.querySelectorAll(e):e:t&&t!==document&&t.children&&0<t.children.length&&(n=t.children),n&&0===n.length&&(n=void 0),n&&!(n instanceof Array)&&n.length<1&&(n=[n]),n||[]},e.prototype._calcElementItemPostion=function(e){var n=this;n._elItems.forEach(function(e,t){n.endAngle=n.itemAngle*t,e._index=t,e.angle=n.endAngle,e.style[l("transformOrigin")]="center center -"+n.r+"px",e.style[l("transform")]="translateZ("+n.r+"px) rotateX("+-n.endAngle+"deg)"}),n.endExceed=n.endAngle+30,n._setItemVisibility(n.beginAngle)}}),d.use(function(e){e.prototype.getSelectedIndex=function(){var e=parseInt((this._angle/this.itemAngle).toFixed(0));return e>this._elItems.length-1&&(e=this._elItems.length-1),e<0&&(e=0),Math.abs(e)},e.prototype.wheelTo=function(e,t,n){var i=this;i._wheelEl.style[l("transition")]="";var r=i._correctAngle(i.itemAngle*e);if(t&&0<t){var o=r-i._angle;i._scrollDistAngle(Date.now(),i._angle,o,t,n)}else i._setAngle(r),i._triggerEnd(n)},e.prototype._correctAngle=function(e){return e<this.beginAngle?this.beginAngle:e>this.endAngle?this.endAngle:e},e.prototype._startInertiaScroll=function(e){var t=this,n=e.changedTouches?e.changedTouches[0]:e,i=e.timeStamp||Date.now(),r=(n.pageY-t.lastMoveStart)/(i-t.lastMoveTime),o=0<r?-1:1,s=6e-4*o*-1,a=Math.abs(r/s),l=r*a/2,c=t._angle,g=t._calcAngle(l)*o,h=g;c+g<t.beginExceed&&(a=a*((g=t.beginExceed-c)/h)*.6),c+g>t.endExceed&&(a=a*((g=t.endExceed-c)/h)*.6),0!=g?t._scrollDistAngle(i,c,g,a):t._endScroll()},e.prototype._scrollDistAngle=function(e,t,n,i,r){var o,s,a,l,c=this;c.stopInertiaMove=!1,o=t,s=n,a=i/13,l=0,function e(){if(!c.stopInertiaMove){var t,n=-s*((t=(t=l)/a-1)*t*t*t-1)+o;c._setAngle(n),a-1<++l||n<c.beginExceed||n>c.endExceed?c._endScroll(r):(c.trigger("scroll",{index:c.getSelectedIndex()}),setTimeout(e,13))}}()},e.prototype._endScroll=function(e){var t=this,n=t._wheelEl;if(t._angle<t.beginAngle)n.style[l("transition")]="150ms ease-out",t._setAngle(t.beginAngle);else if(t._angle>t.endAngle)n.style[l("transition")]="150ms ease-out",t._setAngle(t.endAngle);else{var i=parseInt((t._angle/t.itemAngle).toFixed(0));n.style[l("transition")]="100ms ease-out",t._setAngle(t.itemAngle*i)}t._triggerEnd(e)},e.prototype._triggerEnd=function(t){var n=this;setTimeout(function(){var e=n.getSelectedIndex();!n.trigger||e==n.lastIndex&&!0!==t||n.trigger("scrollEnd",{index:e}),n.lastIndex=e,"function"==typeof t&&t()},0)},e.prototype._setItemVisibility=function(n){var i=this,r=i._options;i._elItems.forEach(function(e){var t=Math.abs(e.angle-n);t<i.hightlightRange?e.classList.add(r.activeCls):t<i.visibleRange?(e.classList.add(r.visibleCls),e.classList.remove(r.activeCls)):(e.classList.remove(r.activeCls),e.classList.remove(r.visibleCls))})},e.prototype._setAngle=function(e){var t=this._options;this._angle=e,this._wheelEl.style[l("transform")]="perspective("+t.perspective+") rotateY(0deg) rotateX("+e+"deg)",this._setItemVisibility(e)},e.prototype._calcAngle=function(e){var t=parseFloat(this.r),n=t;e=Math.abs(e);var i=180*parseInt(e/this.d),r=(n*n+t*t-(e%=this.d)*e)/(2*n*t);return i+Math.acos(r)/(Math.PI/180)},e.prototype._initInertiaParams=function(){this.lastMoveTime=0,this.lastMoveStart=0,this.stopInertiaMove=!1},e.prototype._updateInertiaParams=function(e,t){var n=this,i=e.changedTouches?e.changedTouches[0]:e;if(t)n.lastMoveStart=i.pageY,n.lastMoveTime=e.timeStamp||Date.now(),n.startAngle=n._angle;else{var r=e.timeStamp||Date.now();300<r-n.lastMoveTime&&(n.lastMoveTime=r,n.lastMoveStart=i.pageY)}n.stopInertiaMove=!0},e.prototype._bindEvent=function(){var r=this,e=r._el,o=0,s=null,a=!1;e.addEventListener(g.EVENT_START,function(e){a=!0,e.preventDefault(),r.trigger("scrollStart",{index:r.getSelectedIndex()}),r._wheelEl.style[l("transition")]="",s=(e.changedTouches?e.changedTouches[0]:e).pageY,o=r._angle,r._updateInertiaParams(e,!0)},!1),e.addEventListener(g.EVENT_END,function(e){a=!1,e.preventDefault(),r._startInertiaScroll(e)},!1),e.addEventListener(g.EVENT_CANCEL,function(e){a=!1,e.preventDefault(),r._startInertiaScroll(e)},!1),e.addEventListener(g.EVENT_MOVE,function(e){if(a){e.preventDefault();var t=(e.changedTouches?e.changedTouches[0]:e).pageY-s,n=r._calcAngle(t),i=0<t?o-n:o+n;i>r.endExceed&&(i=r.endExceed),i<r.beginExceed&&(i=r.beginExceed),r._setAngle(i),r._updateInertiaParams(e),r.trigger("scroll",{index:r.getSelectedIndex()})}},!1)}}),d.use(function(e){e.prototype.refresh=function(){var e=this;e.height=e._el.offsetHeight,e.r=e.height/2-10,e.d=2*e.r,e.itemHeight=0<e._elItems.length?e._elItems[0].offsetHeight:40,e.itemAngle=parseInt(e._calcAngle(.8*e.itemHeight)),e.hightlightRange=e.itemAngle/2,e.visibleRange=90,e.beginAngle=0,e.beginExceed=e.beginAngle-30,e._angle=e.beginAngle,h&&(e._wheelEl.style[l("transformOrigin")]="center center "+e.r+"px"),e._calcElementItemPostion(!0)},e.prototype._init=function(e,t){this._initOptions(t),this._initEl(e),this.refresh()},e.prototype._initOptions=function(e){return this._options=function e(t){for(var n=arguments.length,i=Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var o=0;o<i.length;o++){var s=i[o];if(s instanceof Object)for(var a in s)s[a]instanceof Object?t[a]=e(s[a]instanceof Array?[]:{},s[a]):t[a]=s[a]}return t}({},r,e),this._options}}),d.Version="1.0.0",e.default=d,e.Wheel=d,Object.defineProperty(e,"__esModule",{value:!0})});